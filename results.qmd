---
format: 
  html:
    self-contained: true
title: Plant functional group affect on multifunctionality
execute:
  echo: false
bibliography: bibliography.bib
csl: journal-of-ecology.csl
editor: 
  markdown: 
    wrap: sentence
---

```{r}
#| label: set-up
#| echo: false
#| message: false
library(targets)
library(tarchetypes)
library(tidyverse)
library(lubridate)
library(broom)
library(gt)
library(lme4)
library(lmerTest)
library(broom.mixed)

tar_load(big_data_raw)
tar_load(big_data)

```

# Abstract

Climate change threatens biodiversity in plant and soil communities with consequences for key ecosystem functions and services.
Predicting how biodiversity loss affects multiple ecosystem functions (i.e. multifunctionality) has gained traction, but the context-dependent nature of these relationships is poorly understood.
Here we disentangle the direct effects of climate from the indirect effects, mediated through biotic interactions on multifunctionality including ecosystem function of the whole plant-soil food web.
We use a powerful macroecological experimental approach, by replicating a plant functional group removal experiment across factorial broad-scale temperature and precipitation gradients.
We use a multifunctionality approach and assess the effect of plant functional group presence on biodiversity (plants, bryophytes, nematodes, microarthropods, fungi and bacteria) as well as ecosystem functions including biomass, decomposition, carbon and nutrient stocks and dynamics.

Preliminary results show that biodiversity loss reduced multifunctionality, but these responses differ across climate gradients.
The results from this study will improve process understanding on climate change impacts on the multifunctionality of the plant-soil food web of mountain ecosystems, and how this varies along climate gradients and in response to different climate change drivers.

# Introduction

\[Climate change impacts biodiversity and ecosystem functioning\]

\[What is multifunctionality?
Biodiversity-functioning relationships\]

\[What is the research gap?
context dependency in multifunctionality?\]

The aim of this study was to assess how climate change and the presence of three functional groups and combinations of these affects multifunctionality.
Specifically, we test how loss of functional groups affect ecosystem functions across a climate grid.
We use a macroecological experimental approach, by replicating a plant functional group removal experiment (i.e. removal of graminoids, forbs and bryophytes and their combinations) across factorial broad-scale temperature and precipitation gradients.
We recorded taxonomic and functional biodiversity across different organismal groups (plants, bryophytes, microbes, mesofauna), and ecosystem functions (carbon and nutrient stocks and fluxes).
We hypothesize that (i) loss of functional groups decrease ecosystem functions.
Do we have specific hypotheses for graminoids, forbs and bryophytes?
Further, (ii) the decrease in multifunctionality is context dependent.

# Methods

### Site description and experimental design

\[Describe site selection and climate grid, annual precipitation and summer temperature\]

\[Describe the removal experiment\] For more details see (Vandvik et al. 2022).

![Study area, site selection, experimental design, and field sampling overview for the FunCaB plant functional group experiment. (a) Location of the study area and the 12 study sites in Vestland county, Western Norway. (b) The Vestland Climate Grid is established across independent broad-scale biogeographic gradients in summer temperature (mean of four warmest months, °C), and annual precipitation (mean annual precipitation, mm). Temperature levels are given as boreal, sub-alpine, and alpine; precipitation levels range from 1 (dry) to 4 (wet). (c) Experimental design, with the timeline (species composition recordings \[dataset v\], seedling recruitment monitoring \[vi\], ecosystem carbon flux monitoring \[vii\], and functional group removals \[i\] indicated, see legend for dataset symbols, for other datasets see text), an overview of the eight factorial removal treatments, and plot layout with subplots used for the community and seedling recording. The removal treatments are described by the functional groups removed from the respective plots, note that in the figure the 'Intact' plot refers to the no removal controls whereas the 'Gap' are plots with all functional groups removed. For detailed description of treatments and their abbreviations as used in the datasets, see text.](funcab.png)

### Data collection

Overview of ecosystem functions measured across sites and treatments, grouped by functional category.

| Grouping             | Ecosystem function                       | Site | Treatment | Positive values => higher     |
|----------------------|------------------------------------------|------|-----------|---------------------------------------------|
| Primary producers    | Aboveground biomass      | All  | All       | productivity    |
|                      | Belowground biomass      | All  | All       | productivity / nutrient uptake |
|                      | Plant richness (vascular & non-vascular) | All  | All       | biodiversity   |
| Higher trophic level | Nematode density         | All  | only single treatment   | productivity? |
|                      | Mites/collembola density | All  | only single treatment  | productivity?|
|                      | Fungi density            | All  | All       | productivity?           |
|                      | Bacteria density         | All  | All       | productivity?   |
|                      | Meso/microfauna diversity | All     | All   | biodiversity |
| Carbon cycling       | Decomposition of graminoid litter | All     | All       | decomposition  |
|                      | C stock                  | All  | All       | carbon storage  |
|                      | NPP                      | 9    | All       | productivity   |
|                      | GPP                      | 9    | All       | productivity   |
| Nutrient cycling     | N stock                  | All  | All       | nutrient storage  |
|                      | Available phosphate      | All  | only single treatment  | nutrient availability |
|                      | Available micronutrients | All  | only single treatment  | nutrient availability  |

### Multifunctionality approach

Calculations are based on Fanin et al. 2018.

-  **Data transfromation**

    - For all functions, more positive values should be higher functioning. E.g. higher GPP =\> more productive plants; Higher decomposition of litter =\> higher decomposition rate

    - All functions should have positive values. Used transformation (shift by minimun + constant) for those datasets that have negative values. Only mirconutrients have negative values.

    -  Log transfrom some of the variables to make them more normally distributed.

-   Do functions need to be **weighed**?
    No weighing needed, because no function is more desired or has higher value.

-   **Standardized all functions** between 0 and 1 to remove differences in measurement scale between the variables.
    Standardize each of the functions to a common scale by dividing by the maximum observed level of functioning.
    Do we want to use this approach or another one?
    $f(x) = \frac{x_i}{max(x)}$

-   Outlier labeling method?
    (We tackled the outlier issue by removing extreme values following the outlier labelling rule with a tuning parameter^[64](https://www.nature.com/articles/s41559-017-0415-0#ref-CR63 "Maestre, F. T., Castillo‐Monroy, A. P., Bowker, M. A. & Ochoa‐Hueso, R. Species richness effects on ecosystem multifunctionality depend on evenness, composition and spatial pattern. J. Ecol. 100, 317–330 (2012).")^ of *g* = 2.)

-   **Average multifunctionality** was then calculated as the mean of standardized values across all individual functions $MF_a = \frac{1}{F} \sum_{i=1}^{F} g(r_i(f_i))$

-   Threshold-based approaches is appropriate as long as each cluster is weighted equally in the EF-multifunctionality measure, irrespective of the number of functions within each cluster.
    Prevent the overrepresentation of many similar functions

\

### Data analysis

To test if average multifuncitonality is affected by functional groups, summer temperature (scaled) and annual precipitation (scaled) as well as their interactions, we used a linear mixed-effects models with siteID as random effect.

```{r}
#| label: model-multifunctionality
#| echo: true
#| eval: false
#| warning: false

lmer(average multifunctionality ~ functional group x temperature x precipitation + (1/siteID), data)

```

We ran three models using a different approach for functional group:

1) Functional richness: number of functional groups present (0-3)

2) Functional group presence (factorial analysis): forbs, graminoids, bryophytes presence

```{r}
#| label: factorial-approach
#| echo: false
#| eval: true

big_data |> 
distinct(treatment, forb, gram, bryo) |>
mutate(treatment = factor(treatment, levels = c("C", "F", "G", "B", "GF", "FB", "GB", "FGB"))) |>
arrange(treatment) |>
gt() |>
tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  )

```

2) Functional identity: forbs, graminoids, bryophytes (model complex/costly, can only be run without T and P)


We ran these analysis for three groups of the data:

1) Each functional group separately

2) Groups including *primary producers*, *higher trophic levels*, *carbon cycling* and *nutrient cycling*

3) Average multifunctionality

Because not all functions were measured in all treatments and sites, we also ran models with part of the data to test how this affects the results (e.g. only 9 sites, only 5 treatments).

# Results

### Standardized functioning

The effect of plant functional group removal, summer temperature and annual precipitation on single ecosystem functions.

```{r}
#| label: fig-function
#| echo: false
#| warning: false
#| fig-width: 10
#| fig-height: 10
#| fig-cap: Standardized function in response to number of functional groups present across different precipitation levels and alpine, sub-alpine and boreal habitats. The different functions are shown in different colours and the different groups have different symbols.

tar_read(function_figure)

```


### Average multifunctionality

The number of functional groups present and temperature both increased average multifunctionality.

```{r}
#| label: fig-multifunctionality
#| echo: false
#| warning: false
#| fig-cap: Average multifuntionality in response to number of functional groups present and summer temperature (habitat). The colours represent the different habitats. The points are the raw data and the lines represent the predictions from the model (not that the line is a simple lm model for now!).

tar_read(multifunctionality_figure)

```

```{r}
#| label: tbl-model-multi
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of number of functional groups present, summer temperature and annual precipitation on multifunctionality.

tar_read(model_multi_nr_out)

```

The identity of the functional groups removed had an effect on average multifunctionality.
Multifunctionality was reduced when no plants, only forbs or only bryophytes were present.


```{r}
#| label: fig-multifunctionality2
#| echo: false
#| warning: false
#| fig-cap: Average multifuntionality in response to number of functional groups present across different precipitation levels and alpine, sub-alpine and boreal habitats. The different functional groups present are shown in different colours.

tar_read(multifunctionality_figure2)

```

```{r}
#| label: tbl-model-multi-trt
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of treatment on multifunctionality.

tar_read(model_multi_trt_out)

```

### Factorial approach: presence of forbs, graminoids and bryophytes

Predicted multifunctionality from the factorial model (forb × gram × bryo × temperature × precipitation) for each functional group's presence (0 = absent, 1 = present), stratified by habitat (summer temperature) or precipitation.

```{r}
#| label: fig-factorial-multifun-temp
#| echo: false
#| warning: false
#| fig-cap: Predicted multifunctionality in response to presence of forbs, graminoids or bryophytes, by habitat (summer temperature). Points show predictions at each site's observed climate; lines connect mean predictions at absence (0) and presence (1).

tar_read(factorial_multifun_temp_figure)

```

```{r}
#| label: fig-factorial-multifun-prec
#| echo: false
#| warning: false
#| fig-cap: Predicted multifunctionality in response to presence of forbs, graminoids or bryophytes, by precipitation. Points show predictions at each site's observed climate; lines connect mean predictions at absence (0) and presence (1).

tar_read(factorial_multifun_prec_figure)

```

```{r}
#| label: tbl-model-multi-factorial
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of treatment (factorial design), summer temperature and annual precipitation on multifunctionality.

tar_read(model_multi_fact_out)
  
```