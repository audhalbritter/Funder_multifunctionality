```{r}
#| label: set-up-results
#| echo: false
#| message: false
library(targets)
library(tarchetypes)
library(ggplot2)
library(gt)
```

# Results

### Main results (so far)

- Ecosystem functions are affected by functional groups, summer temperature and annual precipitation. So, we expect average multifunctionality also to be affected by these factors.

- Average multifunctionality increased with the number of functional groups present (Figure 2). This effect is stronger for warmer sites when fewer functional groups are present and vice versa for colder sites when more functional groups are present (a bit unclear how this works...). -> Note that previously there was a temperature x FG effect before.

- The identity of functional groups present also affected average multifunctionality (Figure 3). Multifunctionality decreased when one or two groups were removed, and was lowest under bare soil. The presence of forbs and/or graminoid increase multifuntionality more than bryophytes.

- Factorial analysis: the presence of forbs, graminoids and bryophytes increase average multifunctionality (AMF). AMF is higher in warm and dry sites. (There are some 3-way interactions which are difficult to interpret...)

### Standardized functioning (spaghetti plot)

The effect of plant functional group removal, summer temperature and annual precipitation on single ecosystem functions.
This is a very chaotic plot, mostly serves as giving a visual overview and will most likely not be included in the manuscript.

```{r}
#| label: fig-function
#| echo: false
#| warning: false
#| fig-width: 10
#| fig-height: 10
#| fig-cap: Standardized function in response to number of functional groups present across different precipitation levels and alpine, sub-alpine and boreal habitats. The different functions are shown in different colours and the different groups have different symbols.

tar_read(function_figure)

```


### Average multifunctionality

These are the variables included in the multifunctionality analysis.

```{r}
#| label: vars-multifunctionality
#| echo: false
#| warning: false
#| message: false

# Extract variable list from data used in model_multifun (multifunctionality comes from big_data)
tar_load(big_data)
big_data |>
      filter(!response %in% c("decomposition forbs", "ecosystem respiration", "macronutrients", "root_tissue_density_g_per_m3", "root_dry_matter_content")) |> 
      mutate(group = factor(group, levels = c("primary producers", "higher trophic level", "carbon cycling", "nutrient cycling"))) |>
      distinct(group, response, unit) |>
      arrange(group, response) |>
      gt() |>
      tab_style(
        style = cell_text(weight = "bold"),
        locations = cells_column_labels()
      )
```

The number of functional groups present and temperature both increased average multifunctionality.

```{r}
#| label: fig-multifunctionality
#| echo: false
#| warning: false
#| fig-cap: Average multifuntionality in response to number of functional groups present and summer temperature (habitat). The colours represent the different habitats. The points are the raw data and the lines represent the predictions from the model.

tar_read(multifunctionality_figure)

```

```{r}
#| label: tbl-model-multi
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of number of functional groups present, summer temperature and annual precipitation on multifunctionality.

tar_read(model_multi_nr_out)

```

```{r}
#| label: tbl-var-part
#| echo: false
#| tbl-cap: Variance partitioning of multifunctionality into functional groups and climate.

tar_load(multifun_variance_partitioning)

multifun_variance_partitioning$summary_fg_vs_climate |>
      gt::gt() |>
      tab_style(
        style = cell_text(weight = "bold"),
        locations = cells_column_labels()
      )

```

The identity of the functional groups removed had an effect on average multifunctionality.
Multifunctionality was reduced when no plants, only forbs or only bryophytes were present.

```{r}
#| label: fig-multifunctionality2
#| echo: false
#| fig-height: 4
#| fig-cap: Average multifuntionality in response to number of functional groups present across different precipitation levels and alpine, sub-alpine and boreal habitats. The different functional groups present are shown in different colours.

tar_read(multifunctionality_figure2)

```

```{r}
#| label: tbl-model-multi-trt
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of treatment on multifunctionality.

tar_read(model_multi_trt_out)

```

### Factorial approach: presence of forbs, graminoids and bryophytes

Predicted multifunctionality from the factorial model (forb × gram × bryo × temperature × precipitation) for each functional group's presence (0 = absent, 1 = present), stratified by habitat (summer temperature) or precipitation.

```{r}
#| label: fig-factorial-multifun-temp
#| echo: false
#| fig-height: 3
#| fig-cap: Average multifunctionality in response to presence of forbs, graminoids or bryophytes, by habitat (summer temperature). Points show predictions at each site's observed climate; lines connect mean predictions at absence (0) and presence (1).

tar_read(factorial_multifun_temp_figure)

```

```{r}
#| label: fig-factorial-multifun-prec
#| echo: false
#| fig-height: 3
#| fig-cap: Average multifunctionality in response to presence of forbs, graminoids or bryophytes, by precipitation. Points show predictions at each site's observed climate; lines connect mean predictions at absence (0) and presence (1).

tar_read(factorial_multifun_prec_figure)

```

```{r}
#| label: fig-factorial-multifun-combined
#| echo: false
#| fig-height: 6
#| fig-cap: Average multifunctionality in response to presence of forbs, graminoids or bryophytes, by habitat (summer temperature) and precipitation. Colours show precipitation level; panels show habitat. Points show predictions at each site's observed climate; lines connect mean predictions at absence (0) and presence (1).

tar_read(factorial_multifun_combined_figure)

```

```{r}
#| label: tbl-model-multi-factorial
#| echo: false
#| warning: false
#| tbl-cap: Model output from testing effect of treatment (factorial design), summer temperature and annual precipitation on multifunctionality.

tar_read(model_multi_fact_out)
  
```
